# Protocol 설계

## Othello 규칙

- 8X8 보드판을 이용한다 
- 정중앙에 흑/백 돌을 교차로 2개씩 놓고 시작한다
- 상대방의 돌을 따먹기 위해선 자신이 놓을 돌과 자신의 돌 사이에 상대방의 돌이 있어야 한다
- 돌을 놓을수 있는 자리가 없는경우 자신의 순서를 건너뛰고 상대방에게 순서가 넘어간다.
- 모든 자신의 돌이 없게 되는경우 게임이 종료된다.
- 흑/백 모두 돌을 둘 수 없는 경우 게임이 종료된다.


## 동작 순서

1. 돌을 놓으면 클라이언트는 자신이 놓은 자리가 돌을 놓을수 있는 위치인지 확인하고, 정상적인 위치면 서버에게 자신이 돌을 놓은 위치를 보낸다.
2. 서버는 클라이언트에서 받은 정보를 가지고 게임 규칙에 맞게 돌을 재배치 하고, 양쪽 클라이언트에게 전송한다.
3. 클라이언트는 서버에게 받은 정보를 바탕으로 자신의 화면을 그린다.
4. 만약 돌을 놓을 수 없는 자리에 돌을 놓았다면 데이터를 보낸 클라이언트 에게만 경고메시지를 전달한다.
5. 게임이 끝나게 되는 경우 양쪽 클라이언트에게 게임이 끝났다는 정보와 Score(흑/백 돌의 개수)를 전달해준다.

## 내부 로직 

1. 서버는 클라이언트에게 클라이언트가 해야하는 동작을 담은 플레그 값을 보내준다. 플래그에 포함되는 내용은 다음과 같다
- 자신의 턴을 알림
- 잘못된 위치에 돌을 놓음을 알림
- 자신의 턴이지만 돌을 놓을수 있는 곳이 존재하지 않아서 상대방의 턴으로 넘어감
- 상대방의 차례지만 상대방이 돌을 놓을수 있는곳이 존재하지 않아서 자신에게 다시 턴이 돌아옴
- 판에 빈 공간이 있지만 흑/백 모두 돌을 둘수 없어서 게임이 종료됨
- 판에 더이상 빈공간이 있지 않아서 게임이 끝남
<br\>

2. 클라이언트는 서버에서 주는 데이터를 받아서 처리한다. 서버에서 주는 데이터는 다음과 같다
- Flag(1byte) | 턴수 (1byte) | Random(1byte) | 상대방이 돌을 놓은 위치(1byte) | 보드판 돌 현황(16byte) | 현재 스코어(2byte)
<br\>

3. 서버는 클라이언트에게서 오는 정보를 가공하여 다음 행동을 결정한다. 클라이언트에서 보내주는 데이터는 다음과 같다
- ID(흑/백) 1byte | 턴수 (1byte) | Random(1byte) | 돌을 놓은 위치(1byte)
- 서버는 클라이언트가 놓은 돌의 위치를 가지고 보드판 돌의 현황을 업데이트한다.
<br\>


## 상세 설명

1. Server -> Client  

- Flag(1byte) 
	>  자신의 턴을 알림 : 0x01  
    >  잘못된 위치에 돌을 놓았음을 알림 : 0x02  
    >  자신의 턴이지만 돌을 놓을수 있는 곳이 존재하지 않아서 상대방의 턴으로 넘어감 : 0x03  
    >  상대방의 차례지만 상대방이 돌을 놓을수 있는곳이 존재하지 않아서 자신에게 다시 턴이 돌아옴 :0x04  
    >  보드판에 빈 공간이 있지만 흑/백 모두 돌을 둘수 없어서 게임이 종료됨 :0x05  
    >  보드판에 더이상 빈공간이 있지 않아서 게임이 끝남 : 0x06  
<br\>

- 턴수(1byte)
	> 현재 진행되고 있는 턴 수(1~60)
<br\>

- Random(1byte)
	> 서버가 임의로 보내는 데이터 값, 클라이언트 인증에 사용
<br\>

- 상대방이 돌을 놓은 위치(1byte)
	> 상위 1비트는 흑/백 표시(흑:0 , 백:1), 하위 7비트는 돌이 추가된 위치를 표시(1~64)
<img width="372" alt="2" src="https://user-images.githubusercontent.com/33616490/51172964-c6a1ec00-18f7-11e9-8805-13a70ee49af4.png">

> > 해당 돌은 51 이 된다
<br\>

- 보드판 돌 현황(16byte)
	> 1byte는 4개의 칸의 돌 위치를 표시함. 상위 4비트는 돌의 유/무(유:1 무:0) , 하위 4비트는 흑/백(흑:0,백:1) 여부를 표시함
<img width="275" alt="1" src="https://user-images.githubusercontent.com/33616490/51172034-b0932c00-18f5-11e9-99ee-d9d8d3a126be.png">

> > 해당 돌을 표시하기 위해선 0b 1111 0100 이 된다.
<br\>

- 현재 스코어(2byte)
	> 흑/백의 현재 돌 개수를 나타냄, (흑: 상위 1byte, 백: 하위 1byte)
<br\>

2. Client -> Server

- UID(1byte)
	> 자신이 흑이면 0, 백이면 1 을 전송
<br\>

- 턴수(1byte)
	> 서버에서 받은 현재 턴수
<br\>

- Random(1byte)
	> 서버에서 받은 랜덤값
<br\>

- 돌을 놓은 위치
	> 상위 1비트는 흑/백 표시(흑:0 , 백:1), 하위 7비트는 돌이 추가된 위치를 표시(1~64)
<img width="372" alt="2" src="https://user-images.githubusercontent.com/33616490/51172964-c6a1ec00-18f7-11e9-8805-13a70ee49af4.png">
	
> > 해당 돌은 51 이 된다
